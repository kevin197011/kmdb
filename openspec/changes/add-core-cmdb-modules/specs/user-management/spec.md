## ADDED Requirements

### Requirement: 用户创建
系统 SHALL 支持创建新的用户账户，包括用户名、邮箱、密码等基本信息。

#### Scenario: 成功创建用户
- **WHEN** 管理员提供有效的用户信息（用户名、邮箱、密码）
- **THEN** 系统创建用户记录并返回用户 ID
- **AND** 密码使用 bcrypt 进行哈希存储
- **AND** 用户信息保存到数据库
- **AND** 创建操作记录到审计日志

#### Scenario: 创建用户时缺少必填字段
- **WHEN** 管理员提交缺少必填字段（如用户名或邮箱）的用户信息
- **THEN** 系统返回 400 错误和字段验证错误信息

#### Scenario: 创建用户时用户名重复
- **WHEN** 管理员尝试创建与现有用户同名的用户
- **THEN** 系统返回 409 冲突错误，提示用户名已存在

#### Scenario: 创建用户时邮箱重复
- **WHEN** 管理员尝试创建与现有用户相同邮箱的用户
- **THEN** 系统返回 409 冲突错误，提示邮箱已存在

#### Scenario: 创建用户时密码强度不足
- **WHEN** 管理员提供不符合强度要求的密码（少于 8 位或缺少大小写字母/数字）
- **THEN** 系统返回 400 错误，提示密码强度要求

### Requirement: 用户查询
系统 SHALL 支持查询和列出用户记录，支持按状态等条件过滤。

#### Scenario: 查询所有用户
- **WHEN** 管理员请求用户列表
- **THEN** 系统返回所有用户记录的分页列表
- **AND** 包含用户的基本信息（ID、用户名、邮箱、状态、创建时间）
- **AND** 不返回密码哈希

#### Scenario: 按状态过滤用户
- **WHEN** 管理员请求特定状态（如 active）的用户列表
- **THEN** 系统仅返回该状态的用户记录

#### Scenario: 查询单个用户详情
- **WHEN** 管理员请求特定用户 ID 的详情
- **THEN** 系统返回该用户的完整信息（不包括密码）
- **AND** 包含用户的角色和群组信息

#### Scenario: 查询不存在的用户
- **WHEN** 管理员请求不存在的用户 ID
- **THEN** 系统返回 404 错误

### Requirement: 用户更新
系统 SHALL 支持更新现有用户的信息。

#### Scenario: 成功更新用户信息
- **WHEN** 管理员提供有效的用户 ID 和更新数据
- **THEN** 系统更新用户记录
- **AND** 返回更新后的用户信息
- **AND** 更新操作记录到审计日志（包含变更前后状态）

#### Scenario: 更新用户邮箱为已存在的邮箱
- **WHEN** 管理员尝试将用户邮箱更新为已存在的邮箱
- **THEN** 系统返回 409 冲突错误，提示邮箱已存在

#### Scenario: 更新不存在的用户
- **WHEN** 管理员尝试更新不存在的用户 ID
- **THEN** 系统返回 404 错误

### Requirement: 用户删除
系统 SHALL 支持删除用户账户。

#### Scenario: 成功删除用户
- **WHEN** 管理员请求删除用户
- **THEN** 系统删除用户记录
- **AND** 删除操作记录到审计日志
- **AND** 返回成功响应

#### Scenario: 删除当前登录用户
- **WHEN** 管理员尝试删除当前正在登录的用户
- **THEN** 系统返回 400 错误，提示不能删除当前用户

#### Scenario: 删除不存在的用户
- **WHEN** 管理员尝试删除不存在的用户 ID
- **THEN** 系统返回 404 错误

### Requirement: 用户登录
系统 SHALL 支持用户通过用户名和密码登录。

#### Scenario: 成功登录
- **WHEN** 用户提供有效的用户名和密码
- **THEN** 系统验证密码
- **AND** 生成 JWT token 和 refresh token
- **AND** 返回 token 信息
- **AND** 登录操作记录到审计日志

#### Scenario: 登录时用户名不存在
- **WHEN** 用户提供不存在的用户名
- **THEN** 系统返回 401 认证失败错误
- **AND** 不提示用户名是否存在（安全考虑）

#### Scenario: 登录时密码错误
- **WHEN** 用户提供错误的密码
- **THEN** 系统返回 401 认证失败错误
- **AND** 登录失败操作记录到审计日志

#### Scenario: 登录时用户状态为禁用
- **WHEN** 用户尝试登录但账户状态为禁用
- **THEN** 系统返回 403 错误，提示账户已禁用

### Requirement: 用户登出
系统 SHALL 支持用户登出功能。

#### Scenario: 成功登出
- **WHEN** 用户请求登出
- **THEN** 系统使当前 token 失效
- **AND** 登出操作记录到审计日志
- **AND** 返回成功响应

### Requirement: 密码管理
系统 SHALL 支持用户修改密码和重置密码功能。

#### Scenario: 用户修改自己的密码
- **WHEN** 用户提供当前密码和新密码
- **THEN** 系统验证当前密码
- **AND** 验证新密码强度
- **AND** 更新密码哈希
- **AND** 密码修改操作记录到审计日志

#### Scenario: 修改密码时当前密码错误
- **WHEN** 用户提供错误的当前密码
- **THEN** 系统返回 401 错误，提示当前密码错误

#### Scenario: 管理员重置用户密码
- **WHEN** 管理员请求重置用户密码
- **THEN** 系统生成临时密码或发送重置链接
- **AND** 重置操作记录到审计日志

#### Scenario: 修改密码时新密码强度不足
- **WHEN** 用户提供不符合强度要求的新密码
- **THEN** 系统返回 400 错误，提示密码强度要求

### Requirement: Token 刷新
系统 SHALL 支持使用 refresh token 刷新访问 token。

#### Scenario: 成功刷新 token
- **WHEN** 用户提供有效的 refresh token
- **THEN** 系统生成新的 JWT token 和 refresh token
- **AND** 返回新的 token 信息

#### Scenario: 刷新 token 时 token 无效
- **WHEN** 用户提供无效或过期的 refresh token
- **THEN** 系统返回 401 错误，要求重新登录

