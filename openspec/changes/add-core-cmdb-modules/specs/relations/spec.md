## ADDED Requirements

### Requirement: 关系创建
系统 SHALL 支持在资产之间创建关系，包括依赖关系、托管关系和连接关系。

#### Scenario: 成功创建依赖关系
- **WHEN** 用户提供源资产 ID、目标资产 ID 和关系类型 "depends_on"
- **THEN** 系统创建关系记录
- **AND** 返回关系 ID
- **AND** 创建操作记录到审计日志

#### Scenario: 成功创建托管关系
- **WHEN** 用户提供源资产 ID、目标资产 ID 和关系类型 "hosted_on"
- **THEN** 系统创建关系记录
- **AND** 返回关系 ID

#### Scenario: 成功创建连接关系
- **WHEN** 用户提供源资产 ID、目标资产 ID 和关系类型 "connected_to"
- **THEN** 系统创建关系记录
- **AND** 返回关系 ID

#### Scenario: 创建关系时源资产不存在
- **WHEN** 用户尝试创建关系，但源资产 ID 不存在
- **THEN** 系统返回 404 错误，提示源资产不存在

#### Scenario: 创建关系时目标资产不存在
- **WHEN** 用户尝试创建关系，但目标资产 ID 不存在
- **THEN** 系统返回 404 错误，提示目标资产不存在

#### Scenario: 创建自循环关系
- **WHEN** 用户尝试创建源资产和目标资产相同的关系
- **THEN** 系统返回 400 错误，提示不能创建自循环关系

#### Scenario: 创建重复关系
- **WHEN** 用户尝试创建已存在的相同关系（相同源资产、目标资产和关系类型）
- **THEN** 系统返回 409 冲突错误，提示关系已存在

### Requirement: 关系查询
系统 SHALL 支持查询资产的关系信息，包括出站关系、入站关系和双向关系。

#### Scenario: 查询资产的所有出站关系
- **WHEN** 用户请求特定资产的所有出站关系
- **THEN** 系统返回该资产作为源资产的所有关系记录
- **AND** 包含目标资产信息和关系类型

#### Scenario: 查询资产的所有入站关系
- **WHEN** 用户请求特定资产的所有入站关系
- **THEN** 系统返回该资产作为目标资产的所有关系记录
- **AND** 包含源资产信息和关系类型

#### Scenario: 查询资产的所有关系（双向）
- **WHEN** 用户请求特定资产的所有关系（包括出站和入站）
- **THEN** 系统返回该资产的所有关系记录
- **AND** 明确标识关系的方向（出站/入站）

#### Scenario: 按关系类型过滤
- **WHEN** 用户请求特定资产和特定关系类型的关系
- **THEN** 系统仅返回匹配的关系记录

#### Scenario: 查询不存在资产的关系
- **WHEN** 用户请求不存在资产的关系
- **THEN** 系统返回 404 错误

### Requirement: 关系删除
系统 SHALL 支持删除资产之间的关系。

#### Scenario: 成功删除关系
- **WHEN** 用户请求删除特定关系 ID
- **THEN** 系统删除关系记录
- **AND** 删除操作记录到审计日志
- **AND** 返回成功响应

#### Scenario: 删除不存在的关系
- **WHEN** 用户尝试删除不存在的关系 ID
- **THEN** 系统返回 404 错误

### Requirement: 关系拓扑查询
系统 SHALL 支持查询资产的关系拓扑图，用于可视化资产间的依赖关系。

#### Scenario: 查询资产的直接关系拓扑
- **WHEN** 用户请求特定资产的直接关系拓扑（深度为 1）
- **THEN** 系统返回该资产及其直接关联的资产
- **AND** 包含关系类型和方向信息

#### Scenario: 查询资产的多层关系拓扑
- **WHEN** 用户请求特定资产的多层关系拓扑（指定深度）
- **THEN** 系统返回该资产及其多层关联的资产
- **AND** 避免循环引用导致的无限递归

#### Scenario: 查询关系链
- **WHEN** 用户请求从源资产到目标资产的关系路径
- **THEN** 系统返回连接两个资产的关系链
- **AND** 如果不存在路径，返回空结果

