## ADDED Requirements

### Requirement: 审计日志自动记录
系统 SHALL 自动记录所有写操作到审计日志，包括创建、更新、删除等操作。

#### Scenario: 资产创建操作自动记录
- **WHEN** 用户创建资产
- **THEN** 系统自动创建审计日志记录
- **AND** 记录模块名称（assets）、操作类型（create）、资源 ID、用户 ID、操作详情
- **AND** 记录操作时间戳

#### Scenario: 资产更新操作自动记录
- **WHEN** 用户更新资产
- **THEN** 系统自动创建审计日志记录
- **AND** 记录变更前后的状态差异
- **AND** 包含完整的操作上下文

#### Scenario: 资产删除操作自动记录
- **WHEN** 用户删除资产
- **THEN** 系统自动创建审计日志记录
- **AND** 记录被删除资产的完整信息（用于恢复参考）

#### Scenario: 关系创建操作自动记录
- **WHEN** 用户创建资产关系
- **THEN** 系统自动创建审计日志记录
- **AND** 记录源资产和目标资产信息

#### Scenario: 配置快照创建操作自动记录
- **WHEN** 用户创建配置快照
- **THEN** 系统自动创建审计日志记录
- **AND** 记录资产 ID 和版本号

### Requirement: WebSSH 操作审计
系统 SHALL 记录所有 WebSSH 操作，包括登录、命令执行、会话结束等。

#### Scenario: WebSSH 登录记录
- **WHEN** 用户通过 WebSSH 登录到资产
- **THEN** 系统记录登录审计日志
- **AND** 包含用户 ID、资产 ID、登录时间、会话 ID

#### Scenario: WebSSH 命令执行记录
- **WHEN** 用户在 WebSSH 会话中执行命令
- **THEN** 系统记录命令审计日志
- **AND** 包含会话 ID、命令内容、执行时间
- **AND** 可选记录命令输出（敏感信息需脱敏）

#### Scenario: WebSSH 会话结束记录
- **WHEN** WebSSH 会话结束（正常退出或超时）
- **THEN** 系统记录会话结束审计日志
- **AND** 包含会话 ID、结束时间、结束原因

### Requirement: 审计日志查询
系统 SHALL 支持查询和检索审计日志，支持多种过滤条件。

#### Scenario: 查询所有审计日志
- **WHEN** 用户请求审计日志列表
- **THEN** 系统返回分页的审计日志记录
- **AND** 按时间倒序排列（最新在前）

#### Scenario: 按模块过滤审计日志
- **WHEN** 用户请求特定模块（如 assets）的审计日志
- **THEN** 系统仅返回该模块的审计日志记录

#### Scenario: 按操作类型过滤审计日志
- **WHEN** 用户请求特定操作类型（如 create）的审计日志
- **THEN** 系统仅返回该操作类型的审计日志记录

#### Scenario: 按资源 ID 过滤审计日志
- **WHEN** 用户请求特定资源 ID 的审计日志
- **THEN** 系统返回该资源的所有操作历史

#### Scenario: 按用户 ID 过滤审计日志
- **WHEN** 用户请求特定用户 ID 的审计日志
- **THEN** 系统返回该用户的所有操作记录

#### Scenario: 按时间范围过滤审计日志
- **WHEN** 用户请求指定时间范围的审计日志
- **THEN** 系统仅返回该时间范围内的审计日志记录

#### Scenario: 组合条件查询审计日志
- **WHEN** 用户使用多个过滤条件（模块、操作类型、时间范围）查询
- **THEN** 系统返回满足所有条件的审计日志记录

### Requirement: 审计日志详情
系统 SHALL 提供审计日志的详细信息，包括操作上下文和变更内容。

#### Scenario: 查询审计日志详情
- **WHEN** 用户请求特定审计日志 ID 的详情
- **THEN** 系统返回完整的审计日志信息
- **AND** 包含操作详情、变更前后状态（如适用）、用户信息、时间戳

#### Scenario: 审计日志包含操作上下文
- **WHEN** 系统记录审计日志
- **THEN** 审计日志包含足够的上下文信息
- **AND** 支持后续的问题排查和操作追溯

### Requirement: 审计日志不可篡改
系统 SHALL 确保审计日志的完整性和不可篡改性。

#### Scenario: 审计日志只读
- **WHEN** 系统记录审计日志后
- **THEN** 审计日志记录不能被修改或删除（或仅允许管理员在特殊情况下删除）
- **AND** 所有查询操作都是只读的

#### Scenario: 审计日志完整性验证
- **WHEN** 系统记录审计日志
- **THEN** 审计日志包含必要的完整性校验信息（如哈希值）
- **AND** 支持后续的完整性验证

